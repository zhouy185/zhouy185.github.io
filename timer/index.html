<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Course Survey Timer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 30px 40px;
      box-sizing: border-box;
    }

    #top-title {
      text-align: center;
      font-size: 28px;
      margin-bottom: 20px;
    }

    #main-row {
      display: flex;
      gap: 0;
    }

    /* LEFT: image + time settings */
    #image-container {
      flex: 0 0 55%;
      padding-right: 20px;
    }
    #image-container img {
      max-width: 100%;
      max-height: 90vh;
      border: 2px solid #ccc;
      object-fit: contain;
      display: block;
    }

    #divider {
      width: 6px;
      cursor: col-resize;
      background-color: #ddd;
      border-radius: 3px;
      margin: 0 10px;
    }

    /* RIGHT: single timer */
    #right-container {
      flex: 1 1 45%;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    #timer-panel h2 {
      margin-top: 0;
    }

    .timer-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px 15px;
      background: #fff;
    }

    .timer-header {
      display: flex;
      justify-content: space-between;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .timer-main-time {
      font-size: 40px;
      font-weight: bold;
      text-align: center;
      margin: 6px 0;
      min-height: 50px;
    }

    .timer-status-text {
      font-size: 14px;
      text-align: right;
    }

    .finished { color: #2e7d32; }
    .running  { color: #1976d2; }
    .paused   { color: #9c27b0; }
    .ready    { color: #555; }
    .idle     { color: #999; }

    .timer-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      margin-top: 4px;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 20px;
      border: 1px solid #ccc;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: #f7f7f7;
    }

    .icon-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }

    /* Progress bar + runner (runner below bar) */
    .progress-wrapper {
      position: relative;
      height: 40px;
      margin-top: 6px;
    }

    .progress-track {
      position: absolute;
      top: 0;
      left: 0;
      height: 20px;
      width: 100%;
      background-color: #eee;
      border-radius: 11px;
      z-index: -1;
    }

    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 20px;
      width: 0%;
      background-color: #4caf50;
      border-radius: 11px;
      transition: width 0.4s linear;
      background-clip: padding-box;
    }

    .runner {
      position: absolute;
      bottom: 0;
      left: 0%;
      font-size: 24px;
      transition: left 0.4s linear;
      pointer-events: none;
      transform: scaleX(-1);  /* face forward */
    }

    /* Time setting form under the image */
    #timer-form {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fafafa;
    }

    #timer-form input[type="number"] {
      width: 70px;
    }

    body.resizing,
    body.resizing * {
      cursor: col-resize !important;
      user-select: none;
    }
  </style>
</head>
<body>

  <h1 id="top-title">Thank you for your participation!</h1>

  <div id="main-row">
    <!-- LEFT: QR image + timer settings -->
    <div id="image-container">
      <h2>Scan the QR code or use
      <span style="color: blue;">https://mcmaster.bluera.com/mcmaster</span>
      </h2>
      <!-- default image -->
      <img id="image" src="Course_Survey.png" alt="Course survey">
      <br>
      <input type="file" id="fileInput" accept="image/*">

      <div id="timer-form">
        <h2>Timer Settings</h2>

        <label>
          Label:
          <input type="text" id="labelInput" value="Course Survey" style="width: 100%;">
        </label>
        <br><br>

        <strong>Duration</strong><br>
        <input id="durationMin" type="number" value="12" min="0"> min
        <input id="durationSec" type="number" value="0" min="0" max="59"> sec
        <br><br>

        <button id="setTimerBtn">Set timer</button>
        <span id="formMessage" style="margin-left:10px; color:#d32f2f;"></span>
      </div>
    </div>

    <!-- Divider for resizing -->
    <div id="divider"></div>

    <!-- RIGHT: Single timer -->
    <div id="right-container">
      <div id="timer-panel">
        <h2>Timer</h2>
        <div id="timer-card" class="timer-card">
          <!-- filled by JS -->
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      /* ---------- Image upload ---------- */
      var fileInput = document.getElementById("fileInput");
      var imageEl = document.getElementById("image");
      fileInput.onchange = function (e) {
        if (e.target.files && e.target.files[0]) {
          imageEl.src = URL.createObjectURL(e.target.files[0]);
        }
      };

      /* ---------- Resizable split ---------- */
      var divider = document.getElementById("divider");
      var imageContainer = document.getElementById("image-container");
      var rightContainer = document.getElementById("right-container");
      var mainRow = document.getElementById("main-row");
      var isDragging = false;

      divider.addEventListener("mousedown", function () {
        isDragging = true;
        document.body.classList.add("resizing");
      });

      document.addEventListener("mousemove", function (e) {
        if (!isDragging) return;
        var rect = mainRow.getBoundingClientRect();
        var totalWidth = rect.width;
        var newLeftWidth = e.clientX - rect.left;

        var minLeft = 200;
        var maxLeft = totalWidth - 300;
        if (newLeftWidth < minLeft) newLeftWidth = minLeft;
        if (newLeftWidth > maxLeft) newLeftWidth = maxLeft;

        var leftPercent = (newLeftWidth / totalWidth) * 100;
        imageContainer.style.flex = "0 0 " + leftPercent + "%";
        rightContainer.style.flex = "1 1 " + (100 - leftPercent) + "%";
      });

      document.addEventListener("mouseup", function () {
        if (isDragging) {
          isDragging = false;
          document.body.classList.remove("resizing");
        }
      });

      /* ---------- Single timer state ---------- */
      var timer = null;      // { label, duration, remaining, status }
      var intervalId = null;

      var setTimerBtn = document.getElementById("setTimerBtn");
      setTimerBtn.addEventListener("click", setTimerFromForm);

      function setTimerFromForm() {
        var labelInput = document.getElementById("labelInput");
        var durationMin = parseInt(document.getElementById("durationMin").value, 10) || 0;
        var durationSec = parseInt(document.getElementById("durationSec").value, 10) || 0;
        var formMessage = document.getElementById("formMessage");

        var duration = durationMin * 60 + durationSec;
        if (duration <= 0) {
          formMessage.textContent = "Duration must be greater than zero.";
          return;
        } else {
          formMessage.textContent = "";
        }

        var label = labelInput.value.trim() || "Timer";

        stopInterval();
        timer = {
          label: label,
          duration: duration,
          remaining: duration,
          status: "ready"   // "idle","ready","running","paused","finished"
        };
        renderTimer();
      }

      function startInterval() {
        stopInterval();
        intervalId = setInterval(tick, 1000);
      }

      function stopInterval() {
        if (intervalId !== null) {
          clearInterval(intervalId);
          intervalId = null;
        }
      }

      function tick() {
        if (!timer || timer.status !== "running") {
          stopInterval();
          return;
        }
        timer.remaining -= 1;
        if (timer.remaining <= 0) {
          timer.remaining = 0;
          timer.status = "finished";
          stopInterval();
        }
        renderTimer();
      }

      function formatTime(seconds) {
        var s = Math.max(0, seconds);
        var mins = Math.floor(s / 60);
        var secs = s % 60;
        return (
          String(mins).padStart(2, "0") + ":" + String(secs).padStart(2, "0")
        );
      }

      function togglePlayPause() {
        if (!timer) return;

        if (timer.status === "ready" || timer.status === "finished") {
          timer.remaining = timer.duration;
          timer.status = "running";
          startInterval();
        } else if (timer.status === "paused") {
          timer.status = "running";
          startInterval();
        } else if (timer.status === "running") {
          timer.status = "paused";
          stopInterval();
        }
        renderTimer();
      }

      function removeTimer() {
        stopInterval();
        timer = null;
        renderTimer();
      }

      function renderTimer() {
        var card = document.getElementById("timer-card");
        card.innerHTML = "";

        if (!timer) {
          var empty = document.createElement("p");
          empty.textContent = "No timer set. Use the settings on the left to configure one.";
          empty.className = "timer-status-text idle";
          card.appendChild(empty);
          return;
        }

        var label = timer.label;
        var status = timer.status;
        var duration = timer.duration;
        var remaining = timer.remaining;

        var statusText = "";
        var statusClass = "";

        if (status === "ready") {
          statusText = "Ready";
          statusClass = "ready";
        } else if (status === "running") {
          statusText = "Running";
          statusClass = "running";
        } else if (status === "paused") {
          statusText = "Paused";
          statusClass = "paused";
        } else if (status === "finished") {
          statusText = "Complete";
          statusClass = "finished";
        }

        // header
        var header = document.createElement("div");
        header.className = "timer-header";

        var labelSpan = document.createElement("span");
        labelSpan.textContent = label;

        var statusSpan = document.createElement("span");
        statusSpan.textContent = statusText;
        statusSpan.className = "timer-status-text " + statusClass;

        header.appendChild(labelSpan);
        header.appendChild(statusSpan);

        // time display
        var timeDiv = document.createElement("div");
        timeDiv.className = "timer-main-time";

        if (status === "ready") {
          timeDiv.textContent = formatTime(duration);
        } else if (status === "running" || status === "paused" || status === "finished") {
          timeDiv.textContent = formatTime(remaining);
        } else {
          timeDiv.textContent = "";
        }

        // progress
        var progressWrapper = document.createElement("div");
        progressWrapper.className = "progress-wrapper";

        var track = document.createElement("div");
        track.className = "progress-track";

        var bar = document.createElement("div");
        bar.className = "progress-bar";

        var progress = 0;
        if (status === "running" || status === "paused" || status === "finished") {
          if (duration > 0) {
            progress = Math.min((duration - remaining) / duration, 1);
          }
        } else {
          progress = 0;
        }
        bar.style.width = (progress * 100) + "%";

        var runner = document.createElement("div");
        runner.className = "runner";
        runner.textContent = "üèÉ‚Äç‚ôÄÔ∏è";
        runner.style.left = (progress * 100) + "%";

        progressWrapper.appendChild(track);
        progressWrapper.appendChild(bar);
        progressWrapper.appendChild(runner);

        // controls (play/pause + remove)
        var controls = document.createElement("div");
        controls.className = "timer-controls";

        var playPauseBtn = document.createElement("button");
        playPauseBtn.className = "icon-btn";
        var icon = "‚ñ∂";
        if (status === "running") icon = "‚è∏";
        playPauseBtn.textContent = icon;
        playPauseBtn.title = "Play/Pause";
        playPauseBtn.onclick = togglePlayPause;

        if (status === "idle") {
          playPauseBtn.disabled = true;
        }

        var removeBtn = document.createElement("button");
        removeBtn.className = "icon-btn";
        removeBtn.textContent = "‚úñ";
        removeBtn.title = "Remove timer";
        removeBtn.onclick = removeTimer;

        controls.appendChild(playPauseBtn);
        controls.appendChild(removeBtn);

        // assemble card
        card.appendChild(header);
        card.appendChild(timeDiv);
        card.appendChild(progressWrapper);
        card.appendChild(controls);
      }

      // Initialize with default timer (12 minutes, Course Survey)
      timer = {
        label: "Course Survey",
        duration: 12 * 60,
        remaining: 12 * 60,
        status: "ready"
      };
      renderTimer();
    });
  </script>
</body>
</html>

